<table id="weibo_data"></table>

<script>
//瀹炰緥鍖栫紪杈戝櫒
//寤鸿浣跨敤宸ュ巶鏂规硶getEditor鍒涘缓鍜屽紩鐢ㄧ紪杈戝櫒瀹炰緥锛屽鏋滃湪鏌愪釜闂寘涓嬪紩鐢ㄨ缂栬緫鍣紝鐩存帴璋冪敤UE.getEditor('editor')灏辫兘鎷垮埌鐩稿叧鐨勫疄渚�
//var ue = UE.getEditor('editor');
var obj;
var editRow=undefined;//璁板綍褰撳墠姝ｅ湪琚紪杈戠殑琛�
var currentOp;
var flag;

obj=$('#weibo_data').datagrid({
	url:'../../adminServlet',
	queryParams:{op:'findAllAdmin'},
	fitColumns:true,
	striped:true,
	loadMsg:"鏁版嵁鍔犺浇涓�..",
	pagination:true,
	fit:true,
	pageNumber:1,
	pageSize:10,
	pageList:[10,15,20,25,30],
	sortName:'aid',
	remoteSort:false,
	columns:[[
		{field:'',title:'',width:100,align:'center',checkbox:true},
		{field:'aid',title:'绠＄悊鍛樼紪鍙�,width:100,align:'center',sortable:true},
		{field:'aname',title:'绠＄悊鍛樺悕',width:100,align:'center',editor:{type:'text',option:{requires:true}}},
		{field:'pwd',title:'瀵嗙爜',width:100,align:'center',editor:{type:'text',option:{requires:true}},
			formatter:function(val,rec){
				return "********";
			}
		}
	]],
	toolbar:[{
		text:"娣诲姞",
		iconCls:"icon-add",
		handler:function(){
			currentOp="addAdmin";
			flag="娣诲姞";
			if(editRow!=undefined){//璇存槑鏈夎姝ｅ湪琚紪杈�
				obj.datagrid("rejectChanges");//鍥炴粴鎵�湁鏁版嵁
				obj.datagrid("endEdit",editRow);//鍏抽棴姝ｅ湪琚紪杈戠殑琛�
				editRow=undefined;
			}else{
				obj.datagrid('insertRow',{index:0,row:{}});
				obj.datagrid("beginEdit",0);
				editRow=0;//璁板綍褰撳墠琚紪杈戠殑琛岀殑绱㈠紩
			}
		}
	},{
		text:'淇敼',
		iconCls:"icon-edit",
		handler:function(){
			currentOp="updateAdmin";
			flag="淇敼";
			var rows=obj.datagrid("getChecked")[0];
			if(rows!=undefined){
				if(editRow!=undefined){//璇存槑鏈夎姝ｅ湪琚紪杈�
					obj.datagrid("rejectChanges");//鍥炴粴鎵�湁鏁版嵁
					obj.datagrid("endEdit",editRow);//鍏抽棴姝ｅ湪琚紪杈戠殑琛�
					editRow=undefined;
				}else{
					//鑾峰彇鐢ㄦ埛閫変腑鐨勮鐨勭储寮�
					var index=obj.datagrid("getRowIndex",rows);
					console.info(rows);
					obj.datagrid("updateRow",{index:index,row:rows});
					obj.datagrid("beginEdit",index);
					editRow=index;//璁板綍褰撳墠琚紪杈戠殑琛岀殑绱㈠紩
				}
			}else{
				$.messager.show({title:'娓╅Θ鎻愮ず',msg:'璇烽�涓偍瑕佷慨鏀圭殑鏁版嵁.....',timeout:2000,showType:'slide'});
			}
		}
	},{
		text:'鍒犻櫎',
		iconCls:"icon-remove",
		handler:function(){
		//鑾峰彇閫変腑鐨勮
			var rows=obj.datagrid("getChecked");
			if(rows!=undefined){
				$.messager.confirm('淇℃伅纭', '鎮ㄧ湡鐨勮鍒犻櫎閫変腑鐨勬暟鎹悧?', function(rs){
					if (rs){
						var aids="";
						for(var i=0;i<rows.length;i++){
							aids+=rows[i].aid+",";
						}
						
						//鍙戣姹傚埌鏁版嵁搴�
						$.post("../../adminServlet",{op:"delAdmin",'aids':aids},function(data){
							//濡傛灉杩欓噷鐢ㄧ殑鏄疛sonArray浼犻�鐨勶紝灏辫data[0]
							//濡傛灉杩欓噷鐢ㄧ殑鏄疓son锛屽氨鐢╠ata灏卞彲浠�  --銆嬭繖閲岀殑data灏辩浉褰撲簬鏄痡m
							if(data.code=1){
								$.messager.show({title:'鎴愬姛鎻愮ず',msg:"缁堜簬鎴愬姛鍟�,timeout:2000,showType:'slide'});
								rows=null;
								obj.datagrid("reload");//鍒锋柊琛ㄦ牸
							}else{
								$.messager.show({title:'澶辫触鎻愮ず',msg:"杩樻槸澶辫触鍟~~闃挎媺浜嗗暒",timeout:2000,showType:'slide'});
								rows=null;
								obj.datagrid("reload");//鍒锋柊琛ㄦ牸
							}
						});
					}else{
						return;	
					}
				});
			}else{
				$.messager.show({title:'娓╅Θ鎻愮ず',msg:'璇烽�涓偍瑕佸垹闄ょ殑鏁版嵁.....',timeout:2000,showType:'slide'});
			}
		}
	},{
		text:'淇濆瓨',
		iconCls:"icon-save",
		handler:function(){
			//鍏堝叧闂紪杈�
			obj.datagrid("endEdit",editRow);
			//鑾峰彇姝ｅ湪琚紪杈戠殑鏁版嵁
			var rows=obj.datagrid("getChanges");
			//alert(rows);
			if(rows==undefined){//璇存槑娌℃湁琚繚瀛樼殑鏁版嵁
				obj.datagrid("rejectChanges");//鍥炴粴鎵�湁鏁版嵁
				obj.datagrid("endEdit",editRow);//鍏抽棴姝ｅ湪琚紪杈戠殑琛�
				editRow=undefined;
			}else if(rows.tname==""){
				editRow=undefined;
				obj.datagrid("rejectChanges");
			}else{
				//淇濆瓨鍒版暟鎹簱
				//rows["op"]=currentOp;
				var aid=$(rows).attr("aid");//杩欓噷鐢�()灏嗕竴涓猨s瀵硅薄鍖呰９璧锋潵锛屽皢js瀵硅薄杞崲鎴愪竴涓猨query瀵硅薄
				//jquery瀵硅薄--銆媕s瀵硅薄    ===銆�銆�("#div").eq(0);  2銆�("#div")[0]    
				//alert(rows);
				var aname=$(rows).attr("aname");
				var pwd=$(rows).attr("pwd");
				//   $.post("url","data",function(data));//jquery涓皝瑁呯殑post鐨勬柟娉�
					//url锛氳姹傜殑鍦板潃锛屼笉闇�鎷兼帴鍙傛暟锛屽洜涓烘槸鐢╬ost鎻愪氦鐨�
					//data锛氬彲浠ヤ紶涓�釜js瀵硅薄锛屼絾瀹為檯涓婃槸涓�釜json鐨勬暟鎹牸寮忕殑瀛楃涓插嵆鍙�
					//濡傦細{'name':'yhj','sex':'undifine'}
					//function锛坉ata)    :  鍥炶皟鐨勫嚱鏁�
				//alert(rows);
				//rows=$(rows);
				$.post("../../adminServlet",{"op":currentOp,"aid":aid,"aname":aname,'pwd':pwd},function(data){
					if(data>0){
						$.messager.show({
							title:'鎴愬姛鎻愮ず',
							msg:'绠＄悊鍛�+flag+'娣诲姞鎴愬姛....',
							timeout:2000,
							showType:'slide'
						});
						
						rows=null;
						obj.datagrid("reload");//鍒锋柊琛ㄦ牸
						editRow=undefined;
						obj.datagrid("rejectChanges");//鍥炴粴鎵�湁鏁版嵁
						obj.datagrid("endEdit",editRow);//鍏抽棴姝ｅ湪琚紪杈戠殑琛�
					}else{
						$.messager.alert('澶辫触鎻愮ず','绠＄悊鍛�+flag+'娣诲姞澶辫触....','error');
					}
				});
			}
		}
	},{
		text:'鎾ら攢',
		iconCls:"icon-redo",
		handler:function(){
			obj.datagrid("rejectChanges");//鍥炴粴鎵�湁鏁版嵁
			obj.datagrid("endEdit",editRow);//鍏抽棴姝ｅ湪琚紪杈戠殑琛�
			editRow=undefined;	
		}
	}]
});


</script>
